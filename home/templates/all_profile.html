{% extends 'base.html' %}
{% block title %}
Client 
{% endblock title %}
{% block styles %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<style>
    .optext{
        color: white;
        background: purple;
        margin-top: 2px;

    }
    .optdel{
        color: white;
    }
    /* CSS for the progress bar */
.progress-bar-container {
  position: relative;
  width: 100%;
  height: 4px;
  background-color: #f0f0f0;
}

.progress-bar {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background-color: #007bff;
  transition: width 0.3s ease;
}

/* CSS to shield the form */
.form-shield {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(255, 255, 255, 0.7);
  z-index: 9999;
}
</style>
<style>
    .card.user-card {
        border-top: none;
        -webkit-box-shadow: 0 0 1px 2px rgba(0,0,0,0.05), 0 -2px 1px -2px rgba(0,0,0,0.04), 0 0 0 -1px rgba(0,0,0,0.05);
        box-shadow: 0 0 1px 2px rgba(0,0,0,0.05), 0 -2px 1px -2px rgba(0,0,0,0.04), 0 0 0 -1px rgba(0,0,0,0.05);
        -webkit-transition: all 150ms linear;
        transition: all 150ms linear;
    }
    
    .card {
        border-radius: 5px;
        -webkit-box-shadow: 0 1px 2.94px 0.06px rgba(4,26,55,0.16);
        box-shadow: 0 1px 2.94px 0.06px rgba(4,26,55,0.16);
        border: none;
        margin-bottom: 30px;
        -webkit-transition: all 0.3s ease-in-out;
        transition: all 0.3s ease-in-out;
    }
    
    .card .card-header {
        background-color: transparent;
        border-bottom: none;
        padding: 25px;
    }
    
    .card .card-header h5 {
        margin-bottom: 0;
        color: #222;
        font-size: 14px;
        font-weight: 600;
        display: inline-block;
        margin-right: 10px;
        line-height: 1.4;
    }
    
    .card .card-header+.card-block, .card .card-header+.card-block-big {
        padding-top: 0;
    }
    
    .user-card .card-block {
        text-align: center;
    }
    
    .card .card-block {
        padding: 25px;
    }
    
    .user-card .card-block .user-image {
        position: relative;
        margin: 0 auto;
        display: inline-block;
        padding: 5px;
        width: 110px;
        height: 110px;
    }
    
    .user-card .card-block .user-image img {
        z-index: 20;
        position: absolute;
        top: -21px;
        left: -21px;
        width: 150px;
        height: 150px;
    }
    
    .img-radius {
        border-radius: 50%;
    }
    
    .f-w-600 {
        font-weight: 600;
    }
    
    .m-b-10 {
        margin-bottom: 10px;
    }
    
    .m-t-25 {
        margin-top: 25px;
    }
    
    .m-t-15 {
        margin-top: 15px;
    }
    
    .card .card-block p {
        line-height: 1.4;
    }
    
    .text-muted {
        color: #919aa3!important;
    }
    
    .user-card .card-block .activity-leval li.active {
        background-color: #2ed8b6;
    }
    
    .user-card .card-block .activity-leval li {
        display: inline-block;
        width: 15%;
        height: 4px;
        margin: 0 3px;
        background-color: #ccc;
    }
    
    .user-card .card-block .counter-block {
        color: #fff;
    }
    
    .bg-c-blue {
        background: linear-gradient(45deg,#4099ff,#73b4ff);
    }
    
    .bg-c-green {
        background: linear-gradient(45deg,#2ed8b6,#59e0c5);
    }
    
    .bg-c-yellow {
        background: linear-gradient(45deg,#FFB64D,#ffcb80);
    }
    
    .bg-c-pink {
        background: linear-gradient(45deg,#FF5370,#ff869a);
    }
    
    .m-t-10 {
        margin-top: 10px;
    }
    
    .p-20 {
        padding: 20px;
    }
    
    .user-card .card-block .user-social-link i {
        font-size: 30px;
    }
    
    .text-facebook {
        color: #3B5997;
    }
    
    .text-twitter {
        color: #42C0FB;
    }
    
    .text-dribbble {
        color: #EC4A89;
    }
    
    .user-card .card-block .user-image:before {
        bottom: 0;
        border-bottom-left-radius: 50px;
        border-bottom-right-radius: 50px;
    }
    
    .user-card .card-block .user-image:after, .user-card .card-block .user-image:before {
        content: "";
        width: 100%;
        height: 48%;
        border: 2px solid #4099ff;
        position: absolute;
        left: 0;
        z-index: 10;
    }
    
    .user-card .card-block .user-image:after {
        top: 0;
        border-top-left-radius: 50px;
        border-top-right-radius: 50px;
    }
    
    .user-card .card-block .user-image:after, .user-card .card-block .user-image:before {
        content: "";
        width: 100%;
        height: 48%;
        border: 0px solid #4099ff;
        position: absolute;
        left: 0;
        z-index: 10;
    }
    .checked{
        color: #2ed8b6;
    }
</style>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
{% endblock styles %}
{% block script %}

<!-- Add the SweetAlert library -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- ... previous HTML code ... -->

<!-- ... remaining HTML code ... -->

<script>
  {% if alert_type %}
var alertType = "{{ alert_type }}";
console.log(alertType);
var alertMessage = "{{ sucess_message }}";
if (alertType === 'success') {
  Swal.fire(
    "Success!", 
    alertMessage, 
    "success");
} else {
    Swal.fire("Error!", alertMessage, "error");
}
{% endif %}
    var style = document.createElement('style');
style.setAttribute("id","multiselect_dropdown_styles");
style.innerHTML = `
.multiselect-dropdown{
  display: inline-block;
  padding: 2px 5px 0px 5px;
  border-radius: 4px;
  border: solid 1px #ced4da;
  background-color: white;
  position: relative;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right .75rem center;
  background-size: 16px 12px;
}
.multiselect-dropdown span.optext, .multiselect-dropdown span.placeholder{
  margin-right:0.5em; 
  margin-bottom:2px;
  padding:1px 5px; 
  border-radius: 4px; 
  display:inline-block;
}
.multiselect-dropdown {
  background-color:white;
  padding:1px 0.75em; 
  width: 100%
}
.multiselect-dropdown span.optext .optdel {
  float: right;
  margin: 0 -6px 1px 5px;
  font-size: 0.7em;
  margin-top: 5px;
  cursor: pointer;
  padding-right: 8px;

}
.multiselect-dropdown span.optext .optdel:hover { color: #c66;}
.multiselect-dropdown span.placeholder{
  color:#ced4da;
}
.multiselect-dropdown-list-wrapper{
  box-shadow: gray 0 3px 8px;
  z-index: 100;
  padding:2px;
  border-radius: 4px;
  border: solid 1px #ced4da;
  display: none;
  margin: -1px;
  position: absolute;
  top:0;
  left: 0;
  right: 0;
  background: white;
}
.multiselect-dropdown-list-wrapper .multiselect-dropdown-search{
  margin-bottom:5px;
}
.multiselect-dropdown-list{
  padding:2px;
  height: 15rem;
  overflow-y:auto;
  overflow-x: hidden;
}
.multiselect-dropdown-list::-webkit-scrollbar {
  width: 6px;
}
.multiselect-dropdown-list::-webkit-scrollbar-thumb {
  background-color: #bec4ca;
  border-radius:3px;
}

.multiselect-dropdown-list div{
  padding: 5px;
}
.multiselect-dropdown-list input{
  height: 1.15em;
  width: 1.15em;
  margin-right: 0.35em;  
}
.multiselect-dropdown-list div.checked{
}
.multiselect-dropdown-list div:hover{
  background-color: #ced4da;
}
.multiselect-dropdown span.maxselected {width:100%;}
.multiselect-dropdown-all-selector {border-bottom:solid 1px #999;}
`;
document.head.appendChild(style);

function MultiselectDropdown(options){
  var config={
    search:true,
    height:'15rem',
    placeholder:'select',
    txtSelected:'selected',
    txtAll:'All',
    txtRemove: 'Remove',
    txtSearch:'search',
    ...options
  };
  function newEl(tag,attrs){
    var e=document.createElement(tag);
    if(attrs!==undefined) Object.keys(attrs).forEach(k=>{
      if(k==='class') { Array.isArray(attrs[k]) ? attrs[k].forEach(o=>o!==''?e.classList.add(o):0) : (attrs[k]!==''?e.classList.add(attrs[k]):0)}
      else if(k==='style'){  
        Object.keys(attrs[k]).forEach(ks=>{
          e.style[ks]=attrs[k][ks];
        });
       }
      else if(k==='text'){attrs[k]===''?e.innerHTML='&nbsp;':e.innerText=attrs[k]}
      else e[k]=attrs[k];
    });
    return e;
  }

  
  document.querySelectorAll("select[multiple]").forEach((el,k)=>{
    
    var div=newEl('div',{class:'multiselect-dropdown',style:{padding:config.style?.padding??''}});
    el.style.display='none';
    el.parentNode.insertBefore(div,el.nextSibling);
    var listWrap=newEl('div',{class:'multiselect-dropdown-list-wrapper'});
    var list=newEl('div',{class:'multiselect-dropdown-list',style:{height:config.height}});
    var search=newEl('input',{class:['multiselect-dropdown-search'].concat([config.searchInput?.class??'form-control']),style:{width:'100%',display:el.attributes['multiselect-search']?.value==='true'?'block':'none'},placeholder:config.txtSearch});
    listWrap.appendChild(search);
    div.appendChild(listWrap);
    listWrap.appendChild(list);

    el.loadOptions=()=>{
      list.innerHTML='';
      
      if(el.attributes['multiselect-select-all']?.value=='true'){
        var op=newEl('div',{class:'multiselect-dropdown-all-selector'})
        var ic=newEl('input',{type:'checkbox'});
        op.appendChild(ic);
        op.appendChild(newEl('label',{text:config.txtAll}));
  
        op.addEventListener('click',()=>{
          op.classList.toggle('checked');
          op.querySelector("input").checked=!op.querySelector("input").checked;
          
          var ch=op.querySelector("input").checked;
          list.querySelectorAll(":scope > div:not(.multiselect-dropdown-all-selector)")
            .forEach(i=>{if(i.style.display!=='none'){i.querySelector("input").checked=ch; i.optEl.selected=ch}});
  
          el.dispatchEvent(new Event('change'));
        });
        ic.addEventListener('click',(ev)=>{
          ic.checked=!ic.checked;
        });
        el.addEventListener('change', (ev)=>{
          let itms=Array.from(list.querySelectorAll(":scope > div:not(.multiselect-dropdown-all-selector)")).filter(e=>e.style.display!=='none')
          let existsNotSelected=itms.find(i=>!i.querySelector("input").checked);
          if(ic.checked && existsNotSelected) ic.checked=false;
          else if(ic.checked==false && existsNotSelected===undefined) ic.checked=true;
        });
  
        list.appendChild(op);
      }

      Array.from(el.options).map(o=>{
        var op=newEl('div',{class:o.selected?'checked':'',optEl:o})
        var ic=newEl('input',{type:'checkbox',checked:o.selected});
        op.appendChild(ic);
        op.appendChild(newEl('label',{text:o.text}));

        op.addEventListener('click',()=>{
          op.classList.toggle('checked');
          op.querySelector("input").checked=!op.querySelector("input").checked;
          op.optEl.selected=!!!op.optEl.selected;
          el.dispatchEvent(new Event('change'));
        });
        ic.addEventListener('click',(ev)=>{
          ic.checked=!ic.checked;
        });
        o.listitemEl=op;
        list.appendChild(op);
      });
      div.listEl=listWrap;

      div.refresh=()=>{
        div.querySelectorAll('span.optext, span.placeholder').forEach(t=>div.removeChild(t));
        var sels=Array.from(el.selectedOptions);
        if(sels.length>(el.attributes['multiselect-max-items']?.value??5)){
          div.appendChild(newEl('span',{class:['optext','maxselected'],text:sels.length+' '+config.txtSelected}));          
        }
        else{
          sels.map(x=>{
            var c=newEl('span',{class:'optext',text:x.text, srcOption: x});
            if((el.attributes['multiselect-hide-x']?.value !== 'true'))
              c.appendChild(newEl('span',{class:'optdel',text:'🗙',title:config.txtRemove, onclick:(ev)=>{c.srcOption.listitemEl.dispatchEvent(new Event('click'));div.refresh();ev.stopPropagation();}}));

            div.appendChild(c);
          });
        }
        if(0==el.selectedOptions.length) div.appendChild(newEl('span',{class:'placeholder',text:el.attributes['placeholder']?.value??config.placeholder}));
      };
      div.refresh();
    }
    el.loadOptions();
    
    search.addEventListener('input',()=>{
      list.querySelectorAll(":scope div:not(.multiselect-dropdown-all-selector)").forEach(d=>{
        var txt=d.querySelector("label").innerText.toUpperCase();
        d.style.display=txt.includes(search.value.toUpperCase())?'block':'none';
      });
    });

    div.addEventListener('click',()=>{
      div.listEl.style.display='block';
      search.focus();
      search.select();
    });
    
    document.addEventListener('click', function(event) {
      if (!div.contains(event.target)) {
        listWrap.style.display='none';
        div.refresh();
      }
    });    
  });
}

window.addEventListener('load',()=>{
  MultiselectDropdown(window.MultiselectDropdownOptions);
});
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.getElementById('wishlist-form').addEventListener('submit', function(event) {
        event.preventDefault();
        
        Swal.fire({
            title: "Success",
            text: "Profile added to wishlist successfully",
            icon: "success",
        }).then(function() {
            document.getElementById('wishlist-form').submit();
        });
    });
</script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

{% endblock script %}

{% block body %}


<div class="row">
    <div class="grid-margin stretch-card mx-auto col-12 ">
        <div class="card">
            <div class="col-md-6 grid-margin"> 
            <div class="card-body">
            <h4 class="card-title">Filter Options  </h4>
            <p class="card-description">
               Select Category Or Key Skill To Filter The Profiles 
            </p>
            <form class="forms-sample" method="POST" >
                {% csrf_token %}
              
                <div class="form-group">
                    <label for="container1">Category</label>
                    <select class="form-multi-select" multiple data-coreui-search="true" id="cat1" name="categories">
                      {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.category_name }}</option>
                      {% endfor %}
                    </select>
                    </div>  
                    
                <div class="form-group">
                    <label for="container1">Key Skill</label>
                    <select class="form-multi-select" multiple data-coreui-search="true" id="cat1" name="key_skills">
                      {% for key_skill in key_skills %}
                        <option value="{{ key_skill.id }}">{{ key_skill.key_skill_name }}</option>
                      {% endfor %}
                    </select>
                    </div>  
                <button type="submit" class="btn btn-primary mr-2">Apply Filter </button>
                <a href="{% url 'all_profile' %}"  class="btn btn-light">Reset Filter </a>
            </form>
        </div>
            </div>
        </div>
    </div>


<div class="container">
    <div class="row">

        {% for user_p in user_ps %}
        <div class="col-md-4">
            <div class="card user-card">
                <div class="card-header">
                    <h5>Profile</h5>
                </div>
                <div class="card-block">
                    <div class="user-image">
                        <img src="/media/{{ user_p.profile_pic }}" class="img-radius" alt="User-Profile-Image">
                    </div>
                    <h6 class="f-w-600 m-t-25 m-b-10">{{ user_p.name }}</h6>
                    <p class="text-muted"> {% for category in user_p.category.all %} {{ category.category_name }} {% if not forloop.last %} | {% endif %}{% endfor %}</p>
                    <hr>
                   
                    
                    {% if user_p.rating >= 1.0 %}
  <span class="fa fa-star checked"></span>
{% else %}
  <span class="fa fa-star"></span>
{% endif %}

{% if user_p.rating >= 2.0 %}
  <span class="fa fa-star checked"></span>
{% else %}
  <span class="fa fa-star"></span>
{% endif %}

{% if user_p.rating >= 3.0 %}
  <span class="fa fa-star checked"></span>
{% else %}
  <span class="fa fa-star"></span>
{% endif %}

{% if user_p.rating >= 4.0 %}
  <span class="fa fa-star checked"></span>
{% else %}
  <span class="fa fa-star"></span>
{% endif %}

{% if user_p.rating >= 5.0 %}
  <span class="fa fa-star checked"></span>
{% else %}
  <span class="fa fa-star"></span>
{% endif %}
                    <p class="m-t-15 text-muted"></p>
                    <p class="text-muted m-t-15">Commercial: {{ user_p.commercial_hr }}/hr, {{ user_p.commercial_day }}/day</p>
                    <hr>
                    <div class="row justify-content-center user-social-link">
                        <div class="col-auto">
                            <a href="{% url 'user_profile' profile_id=user_p.profile_id %}" > <button type="button" class="btn btn-outline-primary btn-icon-text btn-sm">
                                <i class="icon-eye " style="font-size:15px;"></i>
                                View
                              </button></a></div>
                        <div class="col-auto">
                            {% if user.is_authenticated %}
                            {% if user.is_superuser or user.is_staff %}
                                <h5>You Are An Admin</h5>
                            {% else %}
                            

    {% if user_p in wishlist_profiles %}
                                        <h5>Already wishlisted</h5>
                                    {% else %}
                                        <form id="wishlist-form" action="{% url 'add_to_wishlist2' profile_id=user_p.profile_id %}" method="POST">
                                            {% csrf_token %}
                                    <button type="submit" value="Submit" form="wishlist-form" class="btn btn-outline-success btn-icon-text btn-sm">
                                    <i class="icon-paper-clip " style="font-size:15px;"></i>
                                    Wishlist 
                                </button>  </form>
                                {% endif %}
                          {% endif %}
                      {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        {% endfor %}
	</div>
</div>
{% endblock body %}